{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[{"file_id":"1_QC6LXnISRwG2QTwILp3Lq5knPrqU3iy","timestamp":1753803354561}],"mount_file_id":"1jQtUnakUrAgduV9HyuCa_64p66sdobAM","authorship_tag":"ABX9TyO4Mxg1iatkvJ2stI/Ctcl/"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"51a54cae054e4429b81be75a2a92c42a":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_866bdf3daa8a4acea239d9fe08171667","IPY_MODEL_16f8f527362a4b9784bef65de8a2a5af","IPY_MODEL_a65bdcfdd138413f945c46669fdf29ce"],"layout":"IPY_MODEL_f6c167af9eac44348fdb8492c6a2c96b"}},"866bdf3daa8a4acea239d9fe08171667":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b97242048d8c49468f0464a4d93a886f","placeholder":"​","style":"IPY_MODEL_102832bc1bdc4b35af4ec7efeb2c1b2c","value":"100%"}},"16f8f527362a4b9784bef65de8a2a5af":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_78c4f31fd5024a61b49ca9e8452a21a5","max":752,"min":0,"orientation":"horizontal","style":"IPY_MODEL_8c3a2835328545d1ba852cd72ead2069","value":752}},"a65bdcfdd138413f945c46669fdf29ce":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5614bc39c9b045f0bd9b966fe668b3db","placeholder":"​","style":"IPY_MODEL_b066bb3ad9a24b71906dd255becaaa67","value":" 752/752 [03:05&lt;00:00,  4.38it/s]"}},"f6c167af9eac44348fdb8492c6a2c96b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b97242048d8c49468f0464a4d93a886f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"102832bc1bdc4b35af4ec7efeb2c1b2c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"78c4f31fd5024a61b49ca9e8452a21a5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8c3a2835328545d1ba852cd72ead2069":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5614bc39c9b045f0bd9b966fe668b3db":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b066bb3ad9a24b71906dd255becaaa67":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","source":["from google.colab import files\n","import pandas as pd\n","\n","path = \"/content/drive/MyDrive/ind-market-dataset/ind_niftytotalmarket_list.csv\"\n","#path = \"/content/drive/MyDrive/ind-market-dataset/ind_niftytotalmarket_list_test.xlsx\"\n","\n","df=pd.read_csv(path)\n","#df = pd.read_excel(path)\n","df.head(5)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":204},"id":"YtrzjM5XFsO3","executionInfo":{"status":"ok","timestamp":1757742613939,"user_tz":-330,"elapsed":1324,"user":{"displayName":"Machine Learning","userId":"03371129132223021188"}},"outputId":"f6f12caf-63c0-4faf-a78b-d26f4748d135"},"execution_count":1,"outputs":[{"output_type":"execute_result","data":{"text/plain":["               Company Name                Industry     Symbol Series  \\\n","0          360 ONE WAM Ltd.      Financial Services     360ONE     EQ   \n","1             3M India Ltd.             Diversified    3MINDIA     EQ   \n","2            ABB India Ltd.           Capital Goods        ABB     EQ   \n","3                  ACC Ltd.  Construction Materials        ACC     EQ   \n","4  ACME Solar Holdings Ltd.                   Power  ACMESOLAR     EQ   \n","\n","      ISIN Code  \n","0  INE466L01038  \n","1  INE470A01017  \n","2  INE117A01022  \n","3  INE012A01025  \n","4  INE622W01025  "],"text/html":["\n","  <div id=\"df-13cfc45a-3e3c-443e-8573-85d365ea486c\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Company Name</th>\n","      <th>Industry</th>\n","      <th>Symbol</th>\n","      <th>Series</th>\n","      <th>ISIN Code</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>360 ONE WAM Ltd.</td>\n","      <td>Financial Services</td>\n","      <td>360ONE</td>\n","      <td>EQ</td>\n","      <td>INE466L01038</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>3M India Ltd.</td>\n","      <td>Diversified</td>\n","      <td>3MINDIA</td>\n","      <td>EQ</td>\n","      <td>INE470A01017</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>ABB India Ltd.</td>\n","      <td>Capital Goods</td>\n","      <td>ABB</td>\n","      <td>EQ</td>\n","      <td>INE117A01022</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>ACC Ltd.</td>\n","      <td>Construction Materials</td>\n","      <td>ACC</td>\n","      <td>EQ</td>\n","      <td>INE012A01025</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>ACME Solar Holdings Ltd.</td>\n","      <td>Power</td>\n","      <td>ACMESOLAR</td>\n","      <td>EQ</td>\n","      <td>INE622W01025</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-13cfc45a-3e3c-443e-8573-85d365ea486c')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-13cfc45a-3e3c-443e-8573-85d365ea486c button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-13cfc45a-3e3c-443e-8573-85d365ea486c');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    <div id=\"df-b2fb736f-5dd4-4be0-84c8-d5dbef513506\">\n","      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-b2fb736f-5dd4-4be0-84c8-d5dbef513506')\"\n","                title=\"Suggest charts\"\n","                style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","      </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","      <script>\n","        async function quickchart(key) {\n","          const quickchartButtonEl =\n","            document.querySelector('#' + key + ' button');\n","          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","          quickchartButtonEl.classList.add('colab-df-spinner');\n","          try {\n","            const charts = await google.colab.kernel.invokeFunction(\n","                'suggestCharts', [key], {});\n","          } catch (error) {\n","            console.error('Error during call to suggestCharts:', error);\n","          }\n","          quickchartButtonEl.classList.remove('colab-df-spinner');\n","          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","        }\n","        (() => {\n","          let quickchartButtonEl =\n","            document.querySelector('#df-b2fb736f-5dd4-4be0-84c8-d5dbef513506 button');\n","          quickchartButtonEl.style.display =\n","            google.colab.kernel.accessAllowed ? 'block' : 'none';\n","        })();\n","      </script>\n","    </div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"df","summary":"{\n  \"name\": \"df\",\n  \"rows\": 752,\n  \"fields\": [\n    {\n      \"column\": \"Company Name\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 752,\n        \"samples\": [\n          \"SRF Ltd.\",\n          \"Sanofi Consumer Healthcare India Ltd.\",\n          \"Nava Ltd.\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Industry\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 22,\n        \"samples\": [\n          \"Financial Services\",\n          \"Forest Materials\",\n          \"Chemicals\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Symbol\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 752,\n        \"samples\": [\n          \"SRF\",\n          \"SANOFICONR\",\n          \"NAVA\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Series\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          \"BE\",\n          \"EQ\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ISIN Code\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 752,\n        \"samples\": [\n          \"INE647A01010\",\n          \"INE0UOS01011\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":1}]},{"cell_type":"code","source":["# Install necessary packages\n","!pip install yfinance pandas tqdm datetime --quiet\n","\n","import pandas as pd\n","import yfinance as yf\n","#from datetime import datetime\n","from datetime import date\n","from tqdm.notebook import tqdm\n","\n","# STEP 1: Read your Nifty stock symbols from CSV\n","# Make sure your CSV has a column named 'Symbol'\n","nifty_df = df\n","nifty_symbols = nifty_df['Symbol'].tolist()\n","\n","# STEP 2: Set up year selection\n","today = date.today()\n","current_year = today.year\n","last_year = current_year - 1\n","start_date = f\"{last_year}-01-01\"\n","end_date = f\"{last_year}-12-31\"\n","\n","print(today, current_year, last_year, start_date, end_date)\n","\n","def fibonacci_pivots(h, l, c):\n","    pp = (h + l + c) / 3\n","    return {\n","        'PP': float(pp),\n","        'R1': float(pp + (h - l) * 0.382),\n","        'R2': float(pp + (h - l) * 0.618),\n","        'R3': float(pp + (h - l)),\n","        'S1': float(pp - (h - l) * 0.382),\n","        'S2': float(pp - (h - l) * 0.618),\n","        'S3': float(pp - (h - l))\n","    }\n","\n","below_S2 = []\n","below_S3 = []\n","below_PP = []\n","below_R3 = []\n","\n","# STEP 3: For each stock, download historical data and apply Fibonacci filter\n","for symbol in tqdm(nifty_symbols):\n","    ticker = symbol + \".NS\"\n","    try:\n","        # Download ALL data since last year's Jan 1\n","        df = yf.download(ticker, start=start_date, end=today, interval = '1d', progress=False);\n","        if df.empty or (len(df[df.index.year == last_year]) == 0) or (len(df[df.index.year == current_year]) == 0):\n","            continue\n","\n","        # Get last year's yearly OHLC\n","        df_last_year = df[df.index.year == last_year]\n","        print(df_last_year)\n","        o = df_last_year.iloc[0]['Open']         # Opening price first trading day\n","        h = df_last_year['High'].max()           # High of last year\n","        l = df_last_year['Low'].min()            # Low of last year\n","        c = df_last_year.iloc[-1]['Close']       # Close of last trading day of Dec\n","        print(o,h,l,c)\n","\n","        pivots = fibonacci_pivots(h, l, c)\n","\n","        # Get most recent close for this year\n","        df_this_year = df[df.index.year == current_year]\n","        current_close = float(df_this_year.iloc[-1]['Close'])\n","        print (f\"PP:{pivots['PP']}, S2:{pivots['S2']}, S3:{pivots['S3']}\")\n","\n","        if current_close < pivots['S2']:\n","            below_S2.append(symbol)\n","        if current_close < pivots['S3']:\n","            below_S3.append(symbol)\n","        if current_close < pivots['PP']:\n","            below_PP.append(symbol)\n","        if current_close < pivots['R3']:\n","            below_R3.append(symbol)\n","\n","    except Exception as e:\n","        print(f\"Error for {symbol}: {str(e)}\")\n","        continue\n"],"metadata":{"id":"kS3XZKCmKdo0","executionInfo":{"status":"ok","timestamp":1757742814860,"user_tz":-330,"elapsed":200928,"user":{"displayName":"Machine Learning","userId":"03371129132223021188"}},"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["51a54cae054e4429b81be75a2a92c42a","866bdf3daa8a4acea239d9fe08171667","16f8f527362a4b9784bef65de8a2a5af","a65bdcfdd138413f945c46669fdf29ce","f6c167af9eac44348fdb8492c6a2c96b","b97242048d8c49468f0464a4d93a886f","102832bc1bdc4b35af4ec7efeb2c1b2c","78c4f31fd5024a61b49ca9e8452a21a5","8c3a2835328545d1ba852cd72ead2069","5614bc39c9b045f0bd9b966fe668b3db","b066bb3ad9a24b71906dd255becaaa67"],"output_embedded_package_id":"1vgVzcp9eNcH4PhM7JYiVWBvkkg9R7HiA"},"outputId":"bc52b562-9b12-4dde-e512-1335d60397ef"},"execution_count":2,"outputs":[{"output_type":"display_data","data":{"text/plain":"Output hidden; open in https://colab.research.google.com to view."},"metadata":{}}]},{"cell_type":"code","source":["print(\"Stocks currently below S2:\", below_S2)\n","print(\"Stocks currently below S3:\", below_S3)\n","print(\"Stocks currently below PP:\", below_PP)"],"metadata":{"id":"T1DZ1KMCzkaY","executionInfo":{"status":"ok","timestamp":1757742814876,"user_tz":-330,"elapsed":14,"user":{"displayName":"Machine Learning","userId":"03371129132223021188"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"42ff2085-e982-4b24-e601-0a5bd3fa4c22"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Stocks currently below S2: ['ABFRL', 'ALLCARGO', 'BSOFT', 'FIRSTCRY', 'CEIGALL', 'CELLO', 'CENTRALBK', 'CLEAN', 'CONCOR', 'CYIENTDLM', 'CYIENT', 'DEEPAKNTR', 'EASEMYTRIP', 'EMBDL', 'FCL', 'FIVESTAR', 'GATEWAY', 'HAPPSTMNDS', 'IIFLCAPS', 'INDIGOPNTS', 'INFIBEAM', 'IGIL', 'IKS', 'JAIBALAJI', 'JAICORPLTD', 'JINDWORLD', 'KNRCON', 'MAHLIFE', 'MANINFRA', 'NOCIL', 'NTPCGREEN', 'ORCHPHARMA', 'PATELENG', 'PRAJIND', 'RAYMONDLSL', 'RAYMOND', 'RESPONIND', 'ROUTE', 'SHAREINDIA', 'RENUKA', 'SIEMENS', 'SONACOMS', 'SONATSOFTW', 'SWSOLAR', 'SULA', 'TVSSCS', 'TCS', 'TATATECH', 'TEAMLEASE', 'UCOBANK', 'UNIMECH', 'VBL', 'MANYAVAR']\n","Stocks currently below S3: ['ABFRL', 'FIRSTCRY', 'CYIENT', 'IGIL', 'IKS', 'JINDWORLD', 'ROUTE', 'SHAREINDIA', 'SONACOMS', 'TEAMLEASE', 'UNIMECH']\n","Stocks currently below PP: ['3MINDIA', 'ABB', 'ACC', 'AGI', 'AIAENG', 'AWL', 'AARTIIND', 'AAVAS', 'ACE', 'ADANIENSOL', 'ADANIENT', 'ADANIGREEN', 'ATGL', 'ABFRL', 'ABREL', 'ADVENZYMES', 'AEGISLOG', 'AETHER', 'AFCONS', 'AHLUCONT', 'AJANTPHARM', 'AKUMS', 'AKZOINDIA', 'APLLTD', 'ALKYLAMINE', 'ALLCARGO', 'ALOKINDS', 'ARE&M', 'AMBUJACEM', 'ANANTRAJ', 'ANGELONE', 'APARINDS', 'PARKHOTELS', 'APOLLOTYRE', 'ARVIND', 'ASHOKA', 'ASIANPAINT', 'ASTRAL', 'ATUL', 'AURIONPRO', 'AUROPHARMA', 'AWFIS', 'AXISBANK', 'BASF', 'BLS', 'BAJAJ-AUTO', 'BAJAJHIND', 'BAJAJHFL', 'BALAMINES', 'BALKRISIND', 'BALRAMCHIN', 'BANDHANBNK', 'BANKBARODA', 'MAHABANK', 'BANSALWIRE', 'BATAINDIA', 'BAYERCROP', 'BEPL', 'BBL', 'BHARATFORG', 'BHEL', 'BIRLACORPN', 'BSOFT', 'BLUEDART', 'BBTC', 'BOMDYEING', 'BOROLTD', 'FIRSTCRY', 'BRIGADE', 'MAPMYINDIA', 'CESC', 'CIEINDIA', 'CMSINFO', 'CRISIL', 'CAMPUS', 'CANFINHOME', 'CGCL', 'CARBORUNIV', 'CASTROLIND', 'CEIGALL', 'CELLO', 'CENTRALBK', 'CERA', 'CHEMPLASTS', 'CHENNPETRO', 'CLEAN', 'COALINDIA', 'COLPAL', 'CAMS', 'CONCORDBIO', 'CONCOR', 'CROMPTON', 'CYIENTDLM', 'CYIENT', 'DCBBANK', 'DCXINDIA', 'DLF', 'DABUR', 'DEEPAKNTR', 'DHANI', 'DYNAMATECH', 'EPL', 'EASEMYTRIP', 'EMIL', 'ELECTCAST', 'ELGIEQUIP', 'EMAMILTD', 'EMBDL', 'EMCURE', 'ENGINERSIN', 'ENTERO', 'EIEL', 'EQUITASBNK', 'ETHOSLTD', 'EUREKAFORB', 'EXIDEIND', 'FDC', 'FINEORG', 'FCL', 'FINCABLES', 'FINPIPE', 'FIVESTAR', 'GRINFRA', 'GAIL', 'GHCL', 'GMMPFAUDLR', 'GANESHHOUC', 'GANECOS', 'GRWRHITECH', 'GARFIBRES', 'GATEWAY', 'GICRE', 'GODREJPROP', 'GOKEX', 'GOPAL', 'GRANULES', 'GRAPHITE', 'GRAVITA', 'GESHIP', 'GREAVESCOT', 'GREENPANEL', 'GAEL', 'FLUOROCHEM', 'GUJGASLTD', 'GNFC', 'GPPL', 'GSFC', 'GSPL', 'HGINFRA', 'HCLTECH', 'HFCL', 'HAPPSTMNDS', 'HATHWAY', 'HAVELLS', 'HEMIPROP', 'HERITGFOOD', 'HIKAL', 'HSCL', 'HCC', 'HINDCOPPER', 'HINDZINC', 'HONASA', 'HONAUT', 'HUDCO', 'ICICIPRULI', 'IFBIND', 'IFCI', 'IIFLCAPS', 'IIFL', 'IRB', 'IRCON', 'ITC', 'ITI', 'IMAGICAA', 'INDGN', 'IEX', 'IOC', 'IOB', 'IRCTC', 'IRFC', 'IREDA', 'INDIGOPNTS', 'ICIL', 'INDUSINDBK', 'INFIBEAM', 'NAUKRI', 'INFY', 'INGERRAND', 'INNOVACAP', 'INOXWIND', 'IGIL', 'IKS', 'IONEXCHANG', 'IPCALAB', 'ISGEC', 'JBCHEPHARM', 'JKIL', 'JBMA', 'JKPAPER', 'JKTYRE', 'JSWENERGY', 'JTLIND', 'JAIBALAJI', 'JAICORPLTD', 'JISLJALEQS', 'J&KBANK', 'JAMNAAUTO', 'JSFB', 'JINDALSAW', 'JINDWORLD', 'JWL', 'JUSTDIAL', 'JYOTHYLAB', 'JYOTICNC', 'KNRCON', 'KPIGREEN', 'KPITTECH', 'KAJARIACER', 'KALYANKJIL', 'KSL', 'KANSAINER', 'KTKBANK', 'KEC', 'KFINTECH', 'KIRLOSENG', 'KIRLPNU', 'LTTS', 'LICHSGFIN', 'LMW', 'LTIM', 'LATENTVIEW', 'LXCHEM', 'LICI', 'LINDEINDIA', 'LLOYDSENGG', 'LODHA', 'LUXIND', 'MMTC', 'MOIL', 'MSTCLTD', 'MTARTECH', 'MGL', 'MAHSEAMLES', 'M&MFIN', 'MAHLIFE', 'MANINFRA', 'MRPL', 'MANKIND', 'MARKSANS', 'MASTEK', 'MAXESTATES', 'BECTORFOOD', 'NATCOPHARM', 'NCC', 'NEOGEN', 'NHPC', 'NSLNISP', 'NOCIL', 'NTPCGREEN', 'NTPC', 'NFL', 'NETWORK18', 'NEWGEN', 'NIVABUPA', 'OBEROIRLTY', 'ONGC', 'OIL', 'OLAELEC', 'OLECTRA', 'OFSS', 'ORCHPHARMA', 'ORIENTCEM', 'ORISSAMINE', 'PNGJL', 'PCJEWELLER', 'PCBL', 'PGEL', 'PIIND', 'PNBHOUSING', 'PNCINFRA', 'PVRINOX', 'PAISALO', 'PARAS', 'PATELENG', 'PERSISTENT', 'PETRONET', 'PHOENIXLTD', 'PPLPHARMA', 'POLYMED', 'POLYPLEX', 'PFC', 'POWERGRID', 'PRAJIND', 'PREMIERENE', 'PRESTIGE', 'PRINCEPIPE', 'PRSMJOHNSN', 'PNB', 'RRKABEL', 'RECLTD', 'RHIM', 'RITES', 'RVNL', 'RAILTEL', 'RAIN', 'RAJESHEXPO', 'RKFORGE', 'RCF', 'RATEGAIN', 'RTNINDIA', 'RTNPOWER', 'RAYMONDLSL', 'RAYMOND', 'REDTAPE', 'REFEX', 'RELINFRA', 'RELIGARE', 'RESPONIND', 'RBA', 'ROSSARI', 'ROUTE', 'SJVN', 'SKFINDIA', 'SAFARI', 'SAGILITY', 'SAMMAANCAP', 'MOTHERSON', 'SANOFI', 'SAPPHIRE', 'SENCO', 'SHAREINDIA', 'SFL', 'SCI', 'SBCL', 'SHOPERSTOP', 'RENUKA', 'SIEMENS', 'SIGNATURE', 'SOBHA', 'SONACOMS', 'SONATSOFTW', 'SPANDANA', 'STARHEALTH', 'SWSOLAR', 'STLTECH', 'STAR', 'STYLAMIND', 'SULA', 'SPARC', 'SUNPHARMA', 'SUNTV', 'SUNDRMFAST', 'SUNTECK', 'SUPRAJIT', 'SUPREMEIND', 'SURYAROSNI', 'SUZLON', 'SWANENERGY', 'SWIGGY', 'SYMPHONY', 'SYNGENE', 'TARC', 'TBOTEK', 'TVSSCS', 'TANLA', 'TATACHEM', 'TATACOMM', 'TCS', 'TATAELXSI', 'TATAINVEST', 'TATAMOTORS', 'TATAPOWER', 'TATATECH', 'TTML', 'TEAMLEASE', 'TIIL', 'TEJASNET', 'TEXRAIL', 'ANUP', 'NIACL', 'THERMAX', 'THOMASCOOK', 'TIMKEN', 'TIPSMUSIC', 'TITAGARH', 'TORNTPOWER', 'TRENT', 'TRIDENT', 'TRIVENI', 'TRITURBINE', 'TIINDIA', 'UCOBANK', 'UNIMECH', 'UBL', 'UNITDSPR', 'VGUARD', 'VMART', 'VIPIND', 'VSTIND', 'VAIBHAVGBL', 'DBREALTY', 'VTL', 'VBL', 'MANYAVAR', 'VENUSPIPES', 'IDEA', 'VOLTAMP', 'VOLTAS', 'WELENT', 'WELSPUNLIV', 'WESTLIFE', 'WHIRLPOOL', 'WIPRO', 'WONDERLA', 'YESBANK', 'ZFCVINDIA', 'ZAGGLE', 'ZEEL', 'ZENTEC', 'EMUDHRA']\n"]}]}]}